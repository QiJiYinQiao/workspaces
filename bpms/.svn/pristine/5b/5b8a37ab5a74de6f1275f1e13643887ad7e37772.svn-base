<%@ page language="java" import="java.util.*" pageEncoding="UTF-8"%>
<%@ taglib prefix="shiro" uri="http://shiro.apache.org/tags" %>
<%
String path = request.getContextPath();
String basePath = request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";
%>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <base href="<%=basePath%>">
    <title>日志管理</title>
	<meta http-equiv="pragma" content="no-cache">
	<meta http-equiv="cache-control" content="no-cache">
	<meta http-equiv="expires" content="0">    
	<meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
	<meta http-equiv="description" content="This is my page">
	<jsp:include page="../../layout/script.jsp"></jsp:include>
	<style type="text/css">
		a{
			text-decoration:none;
		}
	</style>
	<script type="text/javascript">
			var $dg;
			var $grid;
			$(function() {
				 $dg = $("#dg");
				 $grid=$dg.datagrid({
					url : "loanOrder/loanOrderAction!findAllClaimTask.action",
					width : 'auto',
					height : $(this).height()*0.96,
					pagination:true,
					rownumbers:true,
					border:true,
					singleSelect:true,
					nowrap:true,
					multiSort:false,
					columns : [ [ {field : 'name',title : '客户姓名',width : parseInt($(this).width()*0.04)},
					              {field : 'idNo',title : '身份证号',width : parseInt($(this).width()*0.08)},
					              {field : 'age',title : '年龄',width : parseInt($(this).width()*0.02)},
					              {field : 'annualSalary',title : '年收入(单位:万)',width : parseInt($(this).width()*0.06)},
					              {field : 'mortgageStatus',title : '居住情况',width : parseInt($(this).width()*0.1)},
					              {field : 'loanAmount',title : '申请贷款额度(单位:万)',width : parseInt($(this).width()*0.08)},
					              {field : 'loanMin',title : '最低接受额度(单位:万)',width : parseInt($(this).width()*0.08)},
					              {field : 'loanPeriod',title : '申请贷款期限',width : parseInt($(this).width()*0.05)},
					              {field : 'repayMethod',title : '还款方式',width : parseInt($(this).width()*0.05)},
					              {field : 'purpose',title : '贷款用途',width : parseInt($(this).width()*0.12)},
					              {field : 'orderStatus',title : '订单状态',width : parseInt($(this).width()*0.1),
					            	  formatter:function(value,row,index){
					            		  return value.statusName;
					            	  }
				            	  },
					              {field : 'operate',title : '操作',width : parseInt($(this).width()*0.2),
					            	  formatter: function(value,row,index){
		      							var result ="<a href='javascript:void(0);' onclick='lookLoanOrderProcessCommentDialog("+index+");'>查看审批意见</a>　 ";
		      								result+="<a href='javascript:void(0);' onclick='showImage("+index+");'>查看审批流程</a>　 ";
		      								result+="<a href='javascript:void(0);' onclick='handleTaskDialog("+index+");'>办理任务</a>";
					      				return result;
				            	 	 }
					              }
					              ] ],
		              toolbar:'#tb',
		              onClickCell:function(rowIndex, field, value){
		            	  $(this).datagrid("selectRow","rowIndex");
		              }
					              
				});
			});

		// 根据索引获取行的基本信息的函数
		function getRowData (index) {
	        if (!$.isNumeric(index) || index < 0) { return undefined; }
	        var rows = $dg.datagrid("getRows");
	        return rows[index];
	    }
		
		// 查看流程图片
		function showImage (index) {
			var row = this.getRowData(index);
			var src = "loanOrder/loanOrderAction!getDiagramResourceByTaskId.action?taskId="
					+ row.taskId;
			$('#imageDialog').dialog("open");
			$("#image").attr("src", src);
		}
		
		// 处理任务
		function handleTaskDialog(index) {
			var row = this.getRowData(index);
			parent.$.modalDialog.openner= $grid;
			$.ajax({
				type : "POST",
				url : "loanOrder/loanOrderAction!findTaskFormKeyByTaskId.action",
				data : {"taskId":row.taskId},
				success : function(jspName) {
					//console.info(jspName);
					parent.$.modalDialog({
						title : '任务办理',
						width : 1000,
						height : 650,
						href : "jsp/loanOrder/"+jspName});
					}
			});

		}
		
		// 查看流程批注
		function  lookLoanOrderProcessCommentDialog (index) {
			var row = this.getRowData(index);
			parent.$.modalDialog.openner= $grid;
			parent.$.modalDialog({
				title : '审批意见查看',
				width : 1000,
				height : 650,
				href : "jsp/loanOrder/loanOrderProcessComment.jsp"});
		}
	</script>
  </head>
  <body>
      <div data-options="region:'center',border : false">
  		<div class="well well-small" style="margin-left: 5px;margin-top: 5px">
				业务管理-->贷款业务管理-->受理任务
		</div>
		<table id="dg" title="受理任务"></table>
		<div id="handleDialog" class="easyui-dialog" title="申请状态" data-options="border:false,closed:true" style="width: 1400px;height: 500px;">
 			<div data-options="region:'north',title:'North Title',split:true" style="height:200px;">
				<form id="form" method="post">
					<fieldset>
						<legend><img src="extend/fromedit.png" style="margin-bottom: -3px;"/>人员</legend>
						<input name="id" id="id"  type="hidden"/>
						 <table>
							 <tr>
							    <th>名称</th>
								<td><input name="name" id="name" placeholder="请输入日志名称" class="easyui-textbox easyui-validatebox" type="text"/></td>
								<th>身份证号</th>
								<td><input name="idCard" id="idCard" placeholder="请输入身份证号" class="easyui-textbox easyui-validatebox" type="text"/></td>
							 </tr>
							 <tr>
							    <th>年龄</th>
								<td><input name="age" id="age" type="text" class="easyui-textbox easyui-validatebox" required="required"/></td>
								<th>地址</th>
								<td><input name="address" id="address" type="text" class="easyui-textbox easyui-validatebox" required="required"/></td>
							</tr>
							 <tr>
							    <th>现居地址</th>
								<td><input name="cuurentAddress" id="cuurentAddress" type="text" class="easyui-textbox easyui-validatebox" required="required"/></td>
								<th>手机</th>
								<td><input name="phone" id="phone" type="text" class="easyui-textbox easyui-validatebox" required="required"/></td>
							</tr>
							 <tr>
							    <th>地址电话</th>
								<td><input name="addressPhone" id="addressPhone" type="text" class="easyui-textbox easyui-validatebox" required="required"/></td>
								<th>工作单位</th>
								<td><input name="workUnit" id="workUnit" type="text" class="easyui-textbox easyui-validatebox" required="required"/></td>
							</tr>
							<tr>
							 	<th>备注</th>
								<td colspan="3"><input name="comment" id="comment" type="text" class="easyui-textbox easyui-validatebox" required="required"/></td>
							</tr>
							<tr id="button">
								
							</tr>
						 </table>
					</fieldset>
				</form>
			</div>   
    		<div data-options="region:'center',title:'center title'" style="padding:5px;background:#eee;margin-top: 10px;">
   				<table id="lookInvestAppliOrderdg" title="批注信息"></table>
    		</div>   
		    <div id="imageDialog" class="easyui-dialog" title="流程图片" data-options="border:false,closed:true,fit:true">
				<img id="image" src="" >
			</div>
		</div>
  	</div>	
  </body>
</html>
