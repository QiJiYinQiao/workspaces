<%@ page language="java" import="java.util.*" pageEncoding="UTF-8"%>
<%@ taglib prefix="shiro" uri="http://shiro.apache.org/tags" %>
<%
String path = request.getContextPath();
String basePath = request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";
%>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <base href="<%=basePath%>">
    <title>理财产品2222</title>
	<meta http-equiv="pragma" content="no-cache">
	<meta http-equiv="cache-control" content="no-cache">
	<meta http-equiv="expires" content="0">    
	<meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
	<meta http-equiv="description" content="This is my page">
	<jsp:include page="../../layout/script.jsp"></jsp:include>
	<script type="text/javascript">
	
			// 从数据字典中查找出"理财产品状态"的数据。
			var prodStatusArray=jqueryUtil.getTextArr("prod_status");	
		
			var $dg;
			var $grid;
			$(function() {
				
				 $dg = $("#dg");
				 $grid=$dg.datagrid({
					url : "investProduct/investProductAction!getAllInvestProducts.action",
					width : 'auto',
					height : $(this).height()-85,
					pagination:true,
					rownumbers:true,
					border:true,
					singleSelect:true,
					nowrap:true,
					multiSort:false,
					columns : [ 
					            [ {field : 'prodName',            title : '产品名称',           width : parseInt($(this).width()*0.1),  align : 'center'},
					              {field : 'lowLendEdu',          title : '最低出借金额（万元）',   width : parseInt($(this).width()*0.1),  align : 'center',  sortable:true},
					              {field : 'higLendEdu',             title : '最高出借金额（万元）',   width : parseInt($(this).width()*0.1),  align : 'center',  sortable:true},
					              {field : 'lendingCycle',         title : '出借周期（天）',       width : parseInt($(this).width()*0.08),  align : 'center',  sortable:true},
					              {field : 'ars',  title : '年化收益率（%）',          width : parseInt($(this).width()*0.08),  align : 'center'},
					              {field : 'ytm',           title : '到期收益率（%）',          width :parseInt($(this).width()*0.1),   align : 'center'},
					              {field : 'prodStatus',    title : '产品状态',           width :parseInt($(this).width()*0.04),   align : 'center',
										formatter:function(value,row){
						            		  return jqueryUtil.showText(value,prodStatusArray); 
										}				            		  					              	
					              },
					              {field : 'prodDesc',title : '产品描述',                   width : parseInt($(this).width()*0.15),  align : 'center'},
					              {field : 'operType4Product',title : '操作',width : parseInt($(this).width()*0.12),align : 'center',
					            	  formatter: function(value,row,index){
				            			  var result="<a href='javascript:void(0);' onclick='toSaveOrUpdateInvestProductOpenDlg("+index+");'>修改产品</a>&nbsp;&nbsp;&nbsp;&nbsp;";				            			  
				            			  	  result+="<a href='javascript:void(0);' onclick='deleteInvestProduct(\""+row.prodId+"\");'>删除产品</a>&nbsp;&nbsp;&nbsp;&nbsp;" 
				            			  	  result+="<a href='javascript:void(0);' onclick='showInvestProductDetails(\""+row.prodId+"\");'>详情</a>"
			      						  return result;					            		  					            		  
					      				}
								   }
					              
					              ] 
					           ],
					 toolbar : '#tb'					           					          
				});

			});

			
			//点击执行查询
			function doSearch(){
				var queryItem = $("#queryItem").combobox('getValue');
				var operType = $("#operType").combobox('getValue');
				var userInputCondition = $("#userInputCondition").val();												
				console.info("queryItem = "+queryItem+",  operType = "+operType+",  userInputCondition = "+userInputCondition);												
				$("#dg").datagrid('load', 
						{			
							queryItem : queryItem,
							operType : operType,
							operType : operType,
							userInputCondition : userInputCondition			
						}
					);				
				
			}
			
			/** 清空高级查询条件 ，重新加载贷款订单数据**/
			function clearAdvancedQueryConditions(){
				$("#searchForm").form("clear");		
				$("#dg").datagrid('load',{});
			}
			
			
			// 根据索引获取每一行的基本信息
			function getRowData (index) {
		        if (!$.isNumeric(index) || index < 0) { return undefined; }
		        var rows = $grid.datagrid("getRows");
		        return rows[index];
		    }			
			
			/* 动态显示弹出的Dialog的标题,显示"添加"或者"修改"理财产品数据*/
			function changeMyTitle(selectedRow){
				if(null != selectedRow){
					return '修改理财产品';					
				}else{
					return '添加理财产品';
				}
			}
			
			/** 点击按钮，新增或者修改理财产品 **/
			function toSaveOrUpdateInvestProductOpenDlg(index){
				
				var selectedRow = getRowData(index);									 
								
				var $dialog = parent.$.modalDialog({
					/* 动态显示Dialog的标题	*/
					title : changeMyTitle(selectedRow),
					width : 900,
					height : 650,
					href : "jsp/investproducts/addOrUpdateInvestProduct.jsp",
				    modal: true,
				    onLoad:function(){
				    	var saveOrUpdateForm = parent.$.modalDialog.handler.find("#investProductInputOrSaveForm");
				    	saveOrUpdateForm.form("load",selectedRow);
				    },
				    buttons : [ {
						text : '关闭',
						iconCls : 'icon-cancel',
						handler : function() {
							parent.$.modalDialog.handler.dialog('destroy');
							parent.$.modalDialog.handler = undefined;
							$("#dg").datagrid("load");
						}
					}],
					onDestroy:function(){
						$("#dg").datagrid("load");
					},					
				});				
			}
			
			
			/** 删除理财产品  **/
			function deleteInvestProduct(prodId){
		    	$.messager.confirm('删除', '执行删除后，数据将不可恢复,是否执行?', function(d) {
		    		if (d) {
		    			$.ajax( {
		    				type : "POST",
		    				url : 'investProduct/investProductAction!deleteInvestProductById.action',
		    				data : "prodId="+prodId,
		    				dataType:'JSON',
		    				success : function(iJson) {		    					    				
		    					if(iJson.status){
		    						//刷新列表		    						
		    						$("#dg").datagrid("load",{});
		    					}
		    					parent.$.messager.show({
		    						title : iJson.title,
		    						msg : iJson.message,
		    						timeout : 4000 * 2
		    					});	    					
		    				}
 		    			});
		    		}
		    	});		
			}
			
			
			/** 显示理财产品的详情  **/
			function showInvestProductDetails(prodId){
				parent.$.modalDialog({
				    title: '理财产品详情',    
				    width: 850,    
				    height: 650,    
				    closed: false,    
				    cache: false,    
				    href : "investProduct/investProductAction!findInvestProductDetailsById.action?prodId="+prodId,   
				    modal: true,
				    buttons : [ {
						text : '关闭',
						iconCls : 'icon-cancel',
						handler : function() {
							parent.$.modalDialog.handler.dialog('destroy');
							parent.$.modalDialog.handler = undefined;
						}
					}
					]
				});				
			}			
			

		</script>
  </head>
  <body>
      <div data-options="region:'center',border : false">
  		<div class="well well-small" style="margin-left: 5px;margin-top: 5px">
			<span class="badge">高级查询</span>
			<p>
				<form id="searchForm" action="" method="post">
					<table cellpadding="0" cellspacing="1" border="0">
						<tr>	
							<td>选择查询项目：</td>						
							<td>
								<select id="queryItem" name="queryItem" class="easyui-combobox" style="width:130px;"> 
								    <option value="prodName">产品名称</option>    
								    <option value="ars">年化收益率</option>   
								    <option value="ytm">到期收益率</option>   
								    <option value="lowLendEdu">最低出借金额</option>   
								    <option value="higLendEdu">最高出借金额</option>   
								    <option value="lendingCycle">出借周期</option>   
								    <option value="prodStatus">产品状态</option>   
								</select>																								  
							</td>
																		
							<td>
								<select id="operType" name="operType" class="easyui-combobox" style="width:90px;"> 
								    <option value="eq">等于</option>    
								    <option value="ge">大于且等于</option>   
								    <option value="gt">大于</option>   
								    <option value="le">小于且等于</option>   
								    <option value="lt">小于</option>   
								    <option value="ne">不等于</option>   
								</select>																								  
							</td>
							
							<td>
								<input id="userInputCondition" name="userInputCondition" type="text" style="width:200px;"></input>
							</td>
							
							<td>&nbsp;&nbsp;&nbsp;&nbsp;
								<a href="javascript:void(0);" class="easyui-linkbutton" iconCls="icon-search" plain="false" onclick="doSearch();">执行查询</a>&nbsp;&nbsp;
								<a href="javascript:void(0);" class="easyui-linkbutton" iconCls="icon-reload" plain="false" onclick="clearAdvancedQueryConditions()">清空</a>
							</td>
																									
						</tr>						
					</table>
				</form>			
			</p>									
		</div>
		
		
		<div id="tb" style="padding: 2px 0">
			<table cellpadding="0" cellspacing="0">
				<tr>
					<td style="padding-left: 10px">
 						<a href="javascript:void(0);" class="easyui-linkbutton" iconCls="icon-add" plain="false" onclick="toSaveOrUpdateInvestProductOpenDlg();">新增理财产品</a>&nbsp;&nbsp;
 					</td> 
				</tr>
			</table>
		</div>
		
		<table id="dg" title="理财产品列表"></table>
  	</div>
  </body>
</html>
