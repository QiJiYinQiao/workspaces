/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: Apache Tomcat/7.0.59
 * Generated at: 2015-09-21 01:42:43 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp.jsp.loanOrder;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;

public final class loanOrderAttachmentForm_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent {

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private javax.el.ExpressionFactory _el_expressionfactory;
  private org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public void _jspInit() {
    _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
    _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
        throws java.io.IOException, javax.servlet.ServletException {

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html; charset=UTF-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write(' ');
      out.write('\r');
      out.write('\n');

	String path = request.getContextPath();
	String basePath = request.getScheme() + "://"
			+ request.getServerName() + ":" + request.getServerPort()
			+ path + "/";
	String loanOrderId = request.getParameter("loanOrderId");
	String attType = request.getParameter("attType");
	String auditId = request.getParameter("auditId");

      out.write("\r\n");
      out.write("<!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\r\n");
      out.write("<html>\r\n");
      out.write("<head>\r\n");
      out.write("<base href=\"");
      out.print(basePath);
      out.write("\">\r\n");
      out.write("<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\r\n");
      out.write("<title>附件上传</title>\r\n");
      out.write("<script type=\"text/javascript\" src=\"");
      out.print(basePath);
      out.write("/js/xheditor/jquery-1.8.0.min.js\"></script>\r\n");
      out.write("<script type=\"text/javascript\" src=\"");
      out.print(basePath);
      out.write("/webuploader-master/dist/webuploader.js\"></script>\r\n");
      out.write("<link rel=\"stylesheet\" type=\"text/css\" href=\"");
      out.print(basePath);
      out.write("/webuploader-master/css/webuploader.css\" />\r\n");
      out.write("<link rel=\"stylesheet\" type=\"text/css\" href=\"");
      out.print(basePath);
      out.write("/webuploader-master/examples/image-upload/style.css\" />\r\n");
      out.write("</head>\r\n");
      out.write("<body>\r\n");
      out.write("\t<input type=\"hidden\" id=\"auditId\" value=\"");
      out.print(auditId);
      out.write("\">\r\n");
      out.write("    <div id=\"wrapper\">\r\n");
      out.write("        <div id=\"container\">\r\n");
      out.write("            <!--头部，相册选择和格式选择-->\r\n");
      out.write("            <div id=\"uploader\">\r\n");
      out.write("                <div class=\"queueList\">\r\n");
      out.write("                    <div id=\"dndArea\" class=\"placeholder\">\r\n");
      out.write("                        <div id=\"filePicker\"></div>\r\n");
      out.write("                        <p>请选择所要上传的附件</p>\r\n");
      out.write("                    </div>\r\n");
      out.write("                </div>\r\n");
      out.write("                <div class=\"statusBar\" style=\"display:none;\">\r\n");
      out.write("                    <div class=\"progress\">\r\n");
      out.write("                        <span class=\"text\">0%</span>\r\n");
      out.write("                        <span class=\"percentage\"></span>\r\n");
      out.write("                    </div><div class=\"info\"></div>\r\n");
      out.write("                    <div class=\"btns\">\r\n");
      out.write("                        <div id=\"filePicker2\"></div><div class=\"uploadBtn\">开始上传</div>\r\n");
      out.write("                    </div>\r\n");
      out.write("                </div>\r\n");
      out.write("            </div>\r\n");
      out.write("        </div>\r\n");
      out.write("    </div>\r\n");
      out.write("    <script type=\"text/javascript\">\r\n");
      out.write("    (function( $ ){\r\n");
      out.write("        // 当domReady的时候开始初始化\r\n");
      out.write("        $(function() {\r\n");
      out.write("            var $wrap = $('#uploader'),\r\n");
      out.write("            \tloanOrderId = '");
      out.print(loanOrderId);
      out.write("',\r\n");
      out.write("    \t   \t\tattType = '");
      out.print(attType);
      out.write("',\r\n");
      out.write("                // 图片容器\r\n");
      out.write("                $queue = $( '<ul class=\"filelist\"></ul>' )\r\n");
      out.write("                    .appendTo( $wrap.find( '.queueList' ) ),\r\n");
      out.write("\r\n");
      out.write("                // 状态栏，包括进度和控制按钮\r\n");
      out.write("                $statusBar = $wrap.find( '.statusBar' ),\r\n");
      out.write("\r\n");
      out.write("                // 文件总体选择信息。\r\n");
      out.write("                $info = $statusBar.find( '.info' ),\r\n");
      out.write("\r\n");
      out.write("                // 上传按钮\r\n");
      out.write("                $upload = $wrap.find( '.uploadBtn' ),\r\n");
      out.write("\r\n");
      out.write("                // 没选择文件之前的内容。\r\n");
      out.write("                $placeHolder = $wrap.find( '.placeholder' ),\r\n");
      out.write("\r\n");
      out.write("                $progress = $statusBar.find( '.progress' ).hide(),\r\n");
      out.write("\r\n");
      out.write("                // 添加的文件数量\r\n");
      out.write("                fileCount = 0,\r\n");
      out.write("\r\n");
      out.write("                // 添加的文件总大小\r\n");
      out.write("                fileSize = 0,\r\n");
      out.write("\r\n");
      out.write("                // 优化retina, 在retina下这个值是2\r\n");
      out.write("                ratio = window.devicePixelRatio || 1,\r\n");
      out.write("\r\n");
      out.write("                // 缩略图大小\r\n");
      out.write("                thumbnailWidth = 110 * ratio,\r\n");
      out.write("                thumbnailHeight = 110 * ratio,\r\n");
      out.write("\r\n");
      out.write("                // 可能有pedding, ready, uploading, confirm, done.\r\n");
      out.write("                state = 'pedding',\r\n");
      out.write("\r\n");
      out.write("                // 所有文件的进度信息，key为file id\r\n");
      out.write("                percentages = {},\r\n");
      out.write("                // 判断浏览器是否支持图片的base64\r\n");
      out.write("                isSupportBase64 = ( function() {\r\n");
      out.write("                    var data = new Image();\r\n");
      out.write("                    var support = true;\r\n");
      out.write("                    data.onload = data.onerror = function() {\r\n");
      out.write("                        if( this.width != 1 || this.height != 1 ) {\r\n");
      out.write("                            support = false;\r\n");
      out.write("                        }\r\n");
      out.write("                    }\r\n");
      out.write("                    data.src = \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==\";\r\n");
      out.write("                    return support;\r\n");
      out.write("                } )(),\r\n");
      out.write("\r\n");
      out.write("                // 检测是否已经安装flash，检测flash的版本\r\n");
      out.write("                flashVersion = ( function() {\r\n");
      out.write("                    var version;\r\n");
      out.write("\r\n");
      out.write("                    try {\r\n");
      out.write("                        version = navigator.plugins[ 'Shockwave Flash' ];\r\n");
      out.write("                        version = version.description;\r\n");
      out.write("                    } catch ( ex ) {\r\n");
      out.write("                        try {\r\n");
      out.write("                            version = new ActiveXObject('ShockwaveFlash.ShockwaveFlash')\r\n");
      out.write("                                    .GetVariable('$version');\r\n");
      out.write("                        } catch ( ex2 ) {\r\n");
      out.write("                            version = '0.0';\r\n");
      out.write("                        }\r\n");
      out.write("                    }\r\n");
      out.write("                    version = version.match( /\\d+/g );\r\n");
      out.write("                    return parseFloat( version[ 0 ] + '.' + version[ 1 ], 10 );\r\n");
      out.write("                } )(),\r\n");
      out.write("\r\n");
      out.write("                supportTransition = (function(){\r\n");
      out.write("                    var s = document.createElement('p').style,\r\n");
      out.write("                        r = 'transition' in s ||\r\n");
      out.write("                                'WebkitTransition' in s ||\r\n");
      out.write("                                'MozTransition' in s ||\r\n");
      out.write("                                'msTransition' in s ||\r\n");
      out.write("                                'OTransition' in s;\r\n");
      out.write("                    s = null;\r\n");
      out.write("                    return r;\r\n");
      out.write("                })(),\r\n");
      out.write("\r\n");
      out.write("                // WebUploader实例\r\n");
      out.write("                uploader;\r\n");
      out.write("\r\n");
      out.write("            if ( !WebUploader.Uploader.support('flash') && WebUploader.browser.ie ) {\r\n");
      out.write("\r\n");
      out.write("                // flash 安装了但是版本过低。\r\n");
      out.write("                if (flashVersion) {\r\n");
      out.write("                    (function(container) {\r\n");
      out.write("                        window['expressinstallcallback'] = function( state ) {\r\n");
      out.write("                            switch(state) {\r\n");
      out.write("                                case 'Download.Cancelled':\r\n");
      out.write("                                    alert('您取消了更新！')\r\n");
      out.write("                                    break;\r\n");
      out.write("\r\n");
      out.write("                                case 'Download.Failed':\r\n");
      out.write("                                    alert('安装失败')\r\n");
      out.write("                                    break;\r\n");
      out.write("\r\n");
      out.write("                                default:\r\n");
      out.write("                                    alert('安装已成功，请刷新！');\r\n");
      out.write("                                    break;\r\n");
      out.write("                            }\r\n");
      out.write("                            delete window['expressinstallcallback'];\r\n");
      out.write("                        };\r\n");
      out.write("\r\n");
      out.write("                        var swf = './expressInstall.swf';\r\n");
      out.write("                        // insert flash object\r\n");
      out.write("                        var html = '<object type=\"application/' +\r\n");
      out.write("                                'x-shockwave-flash\" data=\"' +  swf + '\" ';\r\n");
      out.write("\r\n");
      out.write("                        if (WebUploader.browser.ie) {\r\n");
      out.write("                            html += 'classid=\"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000\" ';\r\n");
      out.write("                        }\r\n");
      out.write("\r\n");
      out.write("                        html += 'width=\"100%\" height=\"100%\" style=\"outline:0\">'  +\r\n");
      out.write("                            '<param name=\"movie\" value=\"' + swf + '\" />' +\r\n");
      out.write("                            '<param name=\"wmode\" value=\"transparent\" />' +\r\n");
      out.write("                            '<param name=\"allowscriptaccess\" value=\"always\" />' +\r\n");
      out.write("                        '</object>';\r\n");
      out.write("\r\n");
      out.write("                        container.html(html);\r\n");
      out.write("\r\n");
      out.write("                    })($wrap);\r\n");
      out.write("\r\n");
      out.write("                // 压根就没有安转。\r\n");
      out.write("                } else {\r\n");
      out.write("                    $wrap.html('<a href=\"http://www.adobe.com/go/getflashplayer\" target=\"_blank\" border=\"0\"><img alt=\"get flash player\" src=\"http://www.adobe.com/macromedia/style_guide/images/160x41_Get_Flash_Player.jpg\" /></a>');\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                return;\r\n");
      out.write("            } else if (!WebUploader.Uploader.support()) {\r\n");
      out.write("                alert( 'Web Uploader 不支持您的浏览器！');\r\n");
      out.write("                return;\r\n");
      out.write("            }\r\n");
      out.write("\r\n");
      out.write("            // 实例化\r\n");
      out.write("            uploader = WebUploader.create({\r\n");
      out.write("                pick: {\r\n");
      out.write("                    id: '#filePicker',\r\n");
      out.write("                    label: '点击选择附件'\r\n");
      out.write("                },\r\n");
      out.write("                formData: {\r\n");
      out.write("                \tloanOrderId:loanOrderId,\r\n");
      out.write("        \t    \tattType:attType,\r\n");
      out.write("        \t    \tauditId:$(\"#auditId\").val()\r\n");
      out.write("                },\r\n");
      out.write("                //dnd: '#dndArea',\r\n");
      out.write("                paste: '#uploader',\r\n");
      out.write("                swf: '../../dist/Uploader.swf',\r\n");
      out.write("                chunked: false,\r\n");
      out.write("                chunkSize: 512 * 1024,\r\n");
      out.write("                //server: 'uploadAction/uploadAction!upload.action',\r\n");
      out.write("                server: 'attachment/attachmentAction!saveAttachment.action',\r\n");
      out.write("                // runtimeOrder: 'flash',\r\n");
      out.write("\r\n");
      out.write("                // accept: {\r\n");
      out.write("                //     title: 'Images',\r\n");
      out.write("                //     extensions: 'gif,jpg,jpeg,bmp,png',\r\n");
      out.write("                //     mimeTypes: 'image/*'\r\n");
      out.write("                // },\r\n");
      out.write("\r\n");
      out.write("                // 禁掉全局的拖拽功能。这样不会出现图片拖进页面的时候，把图片打开。\r\n");
      out.write("                disableGlobalDnd: true,\r\n");
      out.write("                fileNumLimit: 300,\r\n");
      out.write("                fileSizeLimit: 200 * 1024 * 1024,    // 200 M\r\n");
      out.write("                fileSingleSizeLimit: 50 * 1024 * 1024    // 50 M\r\n");
      out.write("            });\r\n");
      out.write("            \r\n");
      out.write("            // 拖拽时不接受 js, txt 文件。\r\n");
      out.write("            uploader.on( 'dndAccept', function( items ) {\r\n");
      out.write("                var denied = false,\r\n");
      out.write("                    len = items.length,\r\n");
      out.write("                    i = 0,\r\n");
      out.write("                    // 修改js类型\r\n");
      out.write("                    unAllowed = 'text/plain;application/javascript ';\r\n");
      out.write("\r\n");
      out.write("                for ( ; i < len; i++ ) {\r\n");
      out.write("                    // 如果在列表里面\r\n");
      out.write("                    if ( ~unAllowed.indexOf( items[ i ].type ) ) {\r\n");
      out.write("                        denied = true;\r\n");
      out.write("                        break;\r\n");
      out.write("                    }\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                return !denied;\r\n");
      out.write("            });\r\n");
      out.write("\r\n");
      out.write("            uploader.on('dialogOpen', function() {\r\n");
      out.write("                console.log('here');\r\n");
      out.write("            });\r\n");
      out.write("\r\n");
      out.write("            // uploader.on('filesQueued', function() {\r\n");
      out.write("            //     uploader.sort(function( a, b ) {\r\n");
      out.write("            //         if ( a.name < b.name )\r\n");
      out.write("            //           return -1;\r\n");
      out.write("            //         if ( a.name > b.name )\r\n");
      out.write("            //           return 1;\r\n");
      out.write("            //         return 0;\r\n");
      out.write("            //     });\r\n");
      out.write("            // });\r\n");
      out.write("\r\n");
      out.write("            // 添加“添加文件”的按钮，\r\n");
      out.write("            uploader.addButton({\r\n");
      out.write("                id: '#filePicker2',\r\n");
      out.write("                label: '继续添加'\r\n");
      out.write("            });\r\n");
      out.write("\r\n");
      out.write("            uploader.on('ready', function() {\r\n");
      out.write("                window.uploader = uploader;\r\n");
      out.write("            });\r\n");
      out.write("\r\n");
      out.write("            // 当有文件添加进来时执行，负责view的创建\r\n");
      out.write("            function addFile( file ) {\r\n");
      out.write("                var $li = $( '<li id=\"' + file.id + '\">' +\r\n");
      out.write("                        '<p class=\"title\">' + file.name + '</p>' +\r\n");
      out.write("                        '<p class=\"imgWrap\"></p>'+\r\n");
      out.write("                        '<p class=\"progress\"><span></span></p>' +\r\n");
      out.write("                        '</li>' ),\r\n");
      out.write("\r\n");
      out.write("                    $btns = $('<div class=\"file-panel\">' +\r\n");
      out.write("                        '<span class=\"cancel\">删除</span>' +\r\n");
      out.write("                        '<span class=\"rotateRight\">向右旋转</span>' +\r\n");
      out.write("                        '<span class=\"rotateLeft\">向左旋转</span></div>').appendTo( $li ),\r\n");
      out.write("                    $prgress = $li.find('p.progress span'),\r\n");
      out.write("                    $wrap = $li.find( 'p.imgWrap' ),\r\n");
      out.write("                    $info = $('<p class=\"error\"></p>'),\r\n");
      out.write("\r\n");
      out.write("                    showError = function( code ) {\r\n");
      out.write("                        switch( code ) {\r\n");
      out.write("                            case 'exceed_size':\r\n");
      out.write("                                text = '文件大小超出';\r\n");
      out.write("                                break;\r\n");
      out.write("\r\n");
      out.write("                            case 'interrupt':\r\n");
      out.write("                                text = '上传暂停';\r\n");
      out.write("                                break;\r\n");
      out.write("\r\n");
      out.write("                            default:\r\n");
      out.write("                                text = '上传失败，请重试';\r\n");
      out.write("                                break;\r\n");
      out.write("                        }\r\n");
      out.write("\r\n");
      out.write("                        $info.text( text ).appendTo( $li );\r\n");
      out.write("                    };\r\n");
      out.write("\r\n");
      out.write("                if ( file.getStatus() === 'invalid' ) {\r\n");
      out.write("                    showError( file.statusText );\r\n");
      out.write("                } else {\r\n");
      out.write("                    // @todo lazyload\r\n");
      out.write("                    $wrap.text( '预览中' );\r\n");
      out.write("                    uploader.makeThumb( file, function( error, src ) {\r\n");
      out.write("                        var img;\r\n");
      out.write("\r\n");
      out.write("                        if ( error ) {\r\n");
      out.write("                            $wrap.text( '不能预览' );\r\n");
      out.write("                            return;\r\n");
      out.write("                        }\r\n");
      out.write("\r\n");
      out.write("                        if( isSupportBase64 ) {\r\n");
      out.write("                            img = $('<img src=\"'+src+'\">');\r\n");
      out.write("                            $wrap.empty().append( img );\r\n");
      out.write("                        } else {\r\n");
      out.write("                            $.ajax('../../server/preview.php', {\r\n");
      out.write("                                method: 'POST',\r\n");
      out.write("                                data: src,\r\n");
      out.write("                                dataType:'json'\r\n");
      out.write("                            }).done(function( response ) {\r\n");
      out.write("                                if (response.result) {\r\n");
      out.write("                                    img = $('<img src=\"'+response.result+'\">');\r\n");
      out.write("                                    $wrap.empty().append( img );\r\n");
      out.write("                                } else {\r\n");
      out.write("                                    $wrap.text(\"预览出错\");\r\n");
      out.write("                                }\r\n");
      out.write("                            });\r\n");
      out.write("                        }\r\n");
      out.write("                    }, thumbnailWidth, thumbnailHeight );\r\n");
      out.write("\r\n");
      out.write("                    percentages[ file.id ] = [ file.size, 0 ];\r\n");
      out.write("                    file.rotation = 0;\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                file.on('statuschange', function( cur, prev ) {\r\n");
      out.write("                    if ( prev === 'progress' ) {\r\n");
      out.write("                        $prgress.hide().width(0);\r\n");
      out.write("                    } else if ( prev === 'queued' ) {\r\n");
      out.write("                        $li.off( 'mouseenter mouseleave' );\r\n");
      out.write("                        $btns.remove();\r\n");
      out.write("                    }\r\n");
      out.write("\r\n");
      out.write("                    // 成功\r\n");
      out.write("                    if ( cur === 'error' || cur === 'invalid' ) {\r\n");
      out.write("                        console.log( file.statusText );\r\n");
      out.write("                        showError( file.statusText );\r\n");
      out.write("                        percentages[ file.id ][ 1 ] = 1;\r\n");
      out.write("                    } else if ( cur === 'interrupt' ) {\r\n");
      out.write("                        showError( 'interrupt' );\r\n");
      out.write("                    } else if ( cur === 'queued' ) {\r\n");
      out.write("                        percentages[ file.id ][ 1 ] = 0;\r\n");
      out.write("                    } else if ( cur === 'progress' ) {\r\n");
      out.write("                        $info.remove();\r\n");
      out.write("                        $prgress.css('display', 'block');\r\n");
      out.write("                    } else if ( cur === 'complete' ) {\r\n");
      out.write("                        $li.append( '<span class=\"success\"></span>' );\r\n");
      out.write("                    }\r\n");
      out.write("\r\n");
      out.write("                    $li.removeClass( 'state-' + prev ).addClass( 'state-' + cur );\r\n");
      out.write("                });\r\n");
      out.write("\r\n");
      out.write("                $li.on( 'mouseenter', function() {\r\n");
      out.write("                    $btns.stop().animate({height: 30});\r\n");
      out.write("                });\r\n");
      out.write("\r\n");
      out.write("                $li.on( 'mouseleave', function() {\r\n");
      out.write("                    $btns.stop().animate({height: 0});\r\n");
      out.write("                });\r\n");
      out.write("\r\n");
      out.write("                $btns.on( 'click', 'span', function() {\r\n");
      out.write("                    var index = $(this).index(),\r\n");
      out.write("                        deg;\r\n");
      out.write("\r\n");
      out.write("                    switch ( index ) {\r\n");
      out.write("                        case 0:\r\n");
      out.write("                            uploader.removeFile( file );\r\n");
      out.write("                            return;\r\n");
      out.write("\r\n");
      out.write("                        case 1:\r\n");
      out.write("                            file.rotation += 90;\r\n");
      out.write("                            break;\r\n");
      out.write("\r\n");
      out.write("                        case 2:\r\n");
      out.write("                            file.rotation -= 90;\r\n");
      out.write("                            break;\r\n");
      out.write("                    }\r\n");
      out.write("\r\n");
      out.write("                    if ( supportTransition ) {\r\n");
      out.write("                        deg = 'rotate(' + file.rotation + 'deg)';\r\n");
      out.write("                        $wrap.css({\r\n");
      out.write("                            '-webkit-transform': deg,\r\n");
      out.write("                            '-mos-transform': deg,\r\n");
      out.write("                            '-o-transform': deg,\r\n");
      out.write("                            'transform': deg\r\n");
      out.write("                        });\r\n");
      out.write("                    } else {\r\n");
      out.write("                        $wrap.css( 'filter', 'progid:DXImageTransform.Microsoft.BasicImage(rotation='+ (~~((file.rotation/90)%4 + 4)%4) +')');\r\n");
      out.write("                        // use jquery animate to rotation\r\n");
      out.write("                        // $({\r\n");
      out.write("                        //     rotation: rotation\r\n");
      out.write("                        // }).animate({\r\n");
      out.write("                        //     rotation: file.rotation\r\n");
      out.write("                        // }, {\r\n");
      out.write("                        //     easing: 'linear',\r\n");
      out.write("                        //     step: function( now ) {\r\n");
      out.write("                        //         now = now * Math.PI / 180;\r\n");
      out.write("\r\n");
      out.write("                        //         var cos = Math.cos( now ),\r\n");
      out.write("                        //             sin = Math.sin( now );\r\n");
      out.write("\r\n");
      out.write("                        //         $wrap.css( 'filter', \"progid:DXImageTransform.Microsoft.Matrix(M11=\" + cos + \",M12=\" + (-sin) + \",M21=\" + sin + \",M22=\" + cos + \",SizingMethod='auto expand')\");\r\n");
      out.write("                        //     }\r\n");
      out.write("                        // });\r\n");
      out.write("                    }\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("                });\r\n");
      out.write("\r\n");
      out.write("                $li.appendTo( $queue );\r\n");
      out.write("            }\r\n");
      out.write("\r\n");
      out.write("            // 负责view的销毁\r\n");
      out.write("            function removeFile( file ) {\r\n");
      out.write("                var $li = $('#'+file.id);\r\n");
      out.write("\r\n");
      out.write("                delete percentages[ file.id ];\r\n");
      out.write("                updateTotalProgress();\r\n");
      out.write("                $li.off().find('.file-panel').off().end().remove();\r\n");
      out.write("            }\r\n");
      out.write("\r\n");
      out.write("            function updateTotalProgress() {\r\n");
      out.write("                var loaded = 0,\r\n");
      out.write("                    total = 0,\r\n");
      out.write("                    spans = $progress.children(),\r\n");
      out.write("                    percent;\r\n");
      out.write("\r\n");
      out.write("                $.each( percentages, function( k, v ) {\r\n");
      out.write("                    total += v[ 0 ];\r\n");
      out.write("                    loaded += v[ 0 ] * v[ 1 ];\r\n");
      out.write("                } );\r\n");
      out.write("\r\n");
      out.write("                percent = total ? loaded / total : 0;\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("                spans.eq( 0 ).text( Math.round( percent * 100 ) + '%' );\r\n");
      out.write("                spans.eq( 1 ).css( 'width', Math.round( percent * 100 ) + '%' );\r\n");
      out.write("                updateStatus();\r\n");
      out.write("            }\r\n");
      out.write("\r\n");
      out.write("            function updateStatus() {\r\n");
      out.write("                var text = '', stats;\r\n");
      out.write("\r\n");
      out.write("                if ( state === 'ready' ) {\r\n");
      out.write("                    text = '选中' + fileCount + '张图片，共' +\r\n");
      out.write("                            WebUploader.formatSize( fileSize ) + '。';\r\n");
      out.write("                } else if ( state === 'confirm' ) {\r\n");
      out.write("                    stats = uploader.getStats();\r\n");
      out.write("                    if ( stats.uploadFailNum ) {\r\n");
      out.write("                        text = '已成功上传' + stats.successNum+ '张照片至XX相册，'+\r\n");
      out.write("                            stats.uploadFailNum + '张照片上传失败，<a class=\"retry\" href=\"#\">重新上传</a>失败图片或<a class=\"ignore\" href=\"#\">忽略</a>'\r\n");
      out.write("                    }\r\n");
      out.write("\r\n");
      out.write("                } else {\r\n");
      out.write("                    stats = uploader.getStats();\r\n");
      out.write("                    text = '共' + fileCount + '张（' +\r\n");
      out.write("                            WebUploader.formatSize( fileSize )  +\r\n");
      out.write("                            '），已上传' + stats.successNum + '张';\r\n");
      out.write("\r\n");
      out.write("                    if ( stats.uploadFailNum ) {\r\n");
      out.write("                        text += '，失败' + stats.uploadFailNum + '张';\r\n");
      out.write("                    }\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                $info.html( text );\r\n");
      out.write("            }\r\n");
      out.write("\r\n");
      out.write("            function setState( val ) {\r\n");
      out.write("                var file, stats;\r\n");
      out.write("\r\n");
      out.write("                if ( val === state ) {\r\n");
      out.write("                    return;\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                $upload.removeClass( 'state-' + state );\r\n");
      out.write("                $upload.addClass( 'state-' + val );\r\n");
      out.write("                state = val;\r\n");
      out.write("\r\n");
      out.write("                switch ( state ) {\r\n");
      out.write("                    case 'pedding':\r\n");
      out.write("                        $placeHolder.removeClass( 'element-invisible' );\r\n");
      out.write("                        $queue.hide();\r\n");
      out.write("                        $statusBar.addClass( 'element-invisible' );\r\n");
      out.write("                        uploader.refresh();\r\n");
      out.write("                        break;\r\n");
      out.write("\r\n");
      out.write("                    case 'ready':\r\n");
      out.write("                        $placeHolder.addClass( 'element-invisible' );\r\n");
      out.write("                        $( '#filePicker2' ).removeClass( 'element-invisible');\r\n");
      out.write("                        $queue.show();\r\n");
      out.write("                        $statusBar.removeClass('element-invisible');\r\n");
      out.write("                        uploader.refresh();\r\n");
      out.write("                        break;\r\n");
      out.write("\r\n");
      out.write("                    case 'uploading':\r\n");
      out.write("                        $( '#filePicker2' ).addClass( 'element-invisible' );\r\n");
      out.write("                        $progress.show();\r\n");
      out.write("                        $upload.text( '暂停上传' );\r\n");
      out.write("                        break;\r\n");
      out.write("\r\n");
      out.write("                    case 'paused':\r\n");
      out.write("                        $progress.show();\r\n");
      out.write("                        $upload.text( '继续上传' );\r\n");
      out.write("                        break;\r\n");
      out.write("\r\n");
      out.write("                    case 'confirm':\r\n");
      out.write("                        $progress.hide();\r\n");
      out.write("                        $( '#filePicker2' ).removeClass( 'element-invisible' );\r\n");
      out.write("                        $upload.text( '开始上传' );\r\n");
      out.write("\r\n");
      out.write("                        stats = uploader.getStats();\r\n");
      out.write("                        if ( stats.successNum && !stats.uploadFailNum ) {\r\n");
      out.write("                            setState( 'finish' );\r\n");
      out.write("                            return;\r\n");
      out.write("                        }\r\n");
      out.write("                        break;\r\n");
      out.write("                    case 'finish':\r\n");
      out.write("                        stats = uploader.getStats();\r\n");
      out.write("                        if ( stats.successNum ) {\r\n");
      out.write("                            alert( '上传成功' );\r\n");
      out.write("                        } else {\r\n");
      out.write("                            // 没有成功的图片，重设\r\n");
      out.write("                            state = 'done';\r\n");
      out.write("                            location.reload();\r\n");
      out.write("                        }\r\n");
      out.write("                        break;\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                updateStatus();\r\n");
      out.write("            }\r\n");
      out.write("\r\n");
      out.write("            uploader.onUploadProgress = function( file, percentage ) {\r\n");
      out.write("                var $li = $('#'+file.id),\r\n");
      out.write("                    $percent = $li.find('.progress span');\r\n");
      out.write("\r\n");
      out.write("                $percent.css( 'width', percentage * 100 + '%' );\r\n");
      out.write("                percentages[ file.id ][ 1 ] = percentage;\r\n");
      out.write("                updateTotalProgress();\r\n");
      out.write("            };\r\n");
      out.write("\r\n");
      out.write("            uploader.onFileQueued = function( file ) {\r\n");
      out.write("                fileCount++;\r\n");
      out.write("                fileSize += file.size;\r\n");
      out.write("\r\n");
      out.write("                if ( fileCount === 1 ) {\r\n");
      out.write("                    $placeHolder.addClass( 'element-invisible' );\r\n");
      out.write("                    $statusBar.show();\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                addFile( file );\r\n");
      out.write("                setState( 'ready' );\r\n");
      out.write("                updateTotalProgress();\r\n");
      out.write("            };\r\n");
      out.write("\r\n");
      out.write("            uploader.onFileDequeued = function( file ) {\r\n");
      out.write("                fileCount--;\r\n");
      out.write("                fileSize -= file.size;\r\n");
      out.write("\r\n");
      out.write("                if ( !fileCount ) {\r\n");
      out.write("                    setState( 'pedding' );\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                removeFile( file );\r\n");
      out.write("                updateTotalProgress();\r\n");
      out.write("\r\n");
      out.write("            };\r\n");
      out.write("\r\n");
      out.write("            uploader.on( 'all', function( type ) {\r\n");
      out.write("                var stats;\r\n");
      out.write("                switch( type ) {\r\n");
      out.write("                    case 'uploadFinished':\r\n");
      out.write("                        setState( 'confirm' );\r\n");
      out.write("                        break;\r\n");
      out.write("\r\n");
      out.write("                    case 'startUpload':\r\n");
      out.write("                        setState( 'uploading' );\r\n");
      out.write("                        break;\r\n");
      out.write("\r\n");
      out.write("                    case 'stopUpload':\r\n");
      out.write("                        setState( 'paused' );\r\n");
      out.write("                        break;\r\n");
      out.write("\r\n");
      out.write("                }\r\n");
      out.write("            });\r\n");
      out.write("\r\n");
      out.write("            uploader.onError = function( code ) {\r\n");
      out.write("                alert( 'Eroor: ' + code );\r\n");
      out.write("            };\r\n");
      out.write("\r\n");
      out.write("            $upload.on('click', function() {\r\n");
      out.write("                if ( $(this).hasClass( 'disabled' ) ) {\r\n");
      out.write("                    return false;\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                if ( state === 'ready' ) {\r\n");
      out.write("                    uploader.upload();\r\n");
      out.write("                } else if ( state === 'paused' ) {\r\n");
      out.write("                    uploader.upload();\r\n");
      out.write("                } else if ( state === 'uploading' ) {\r\n");
      out.write("                    uploader.stop();\r\n");
      out.write("                }\r\n");
      out.write("            });\r\n");
      out.write("\r\n");
      out.write("            $info.on( 'click', '.retry', function() {\r\n");
      out.write("                uploader.retry();\r\n");
      out.write("            } );\r\n");
      out.write("\r\n");
      out.write("            $info.on( 'click', '.ignore', function() {\r\n");
      out.write("                alert( 'todo' );\r\n");
      out.write("            } );\r\n");
      out.write("\r\n");
      out.write("            $upload.addClass( 'state-' + state );\r\n");
      out.write("            updateTotalProgress();\r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("    })( jQuery );\r\n");
      out.write("    </script>\r\n");
      out.write("</body>\r\n");
      out.write("</html>\r\n");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try {
            if (response.isCommitted()) {
              out.flush();
            } else {
              out.clearBuffer();
            }
          } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
